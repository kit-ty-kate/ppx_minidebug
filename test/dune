(executable
 (name pp)
 (modules pp)
 (libraries ppx_minidebug ppxlib)
 (modes exe))

(rule
 (targets test_debug_sexp_actual.ml)
 (deps
  (:pp pp.exe)
  (:input test_debug_sexp.ml))
 (action
  (run ./%{pp} --impl %{input} -o %{targets})))

(rule
 (targets test_debug_pp_actual.ml)
 (deps
  (:pp pp.exe)
  (:input test_debug_pp.ml))
 (action
  (run ./%{pp} --impl %{input} -o %{targets})))

(rule
 (targets test_debug_show_actual.ml)
 (deps
  (:pp pp.exe)
  (:input test_debug_show.ml))
 (action
  (run ./%{pp} --impl %{input} -o %{targets})))

(rule
 (alias runtest)
 (action
  (diff test_debug_sexp_expected.ml test_debug_sexp_actual.ml)))

(rule
 (alias runtest)
 (action
  (diff test_debug_pp_expected.ml test_debug_pp_actual.ml)))

(rule
 (alias runtest)
 (action
  (diff test_debug_show_expected.ml test_debug_show_actual.ml)))

(test
 (name test_debug_sexp)
 (modules test_debug_sexp)
 (libraries base core stdio minidebug_runtime)
 (preprocess
  (pps ppx_minidebug ppx_jane)))

(test
 (name test_debug_pp)
 (modules test_debug_pp)
 (libraries minidebug_runtime)
 (preprocess
  (pps ppx_minidebug ppx_deriving.show)))

(test
 (name test_debug_show)
 (modules test_debug_show)
 (libraries minidebug_runtime)
 (preprocess
  (pps ppx_minidebug ppx_deriving.show)))

(test
 (name test_debug_sexp_expected)
 (modules test_debug_sexp_expected)
 (libraries base core stdio minidebug_runtime)
 (preprocess
  (pps ppx_jane)))

(test
 (name test_debug_pp_expected)
 (modules test_debug_pp_expected)
 (libraries minidebug_runtime)
 (preprocess
  (pps ppx_deriving.show)))

(test
 (name test_debug_show_expected)
 (modules test_debug_show_expected)
 (libraries minidebug_runtime)
 (preprocess
  (pps ppx_deriving.show)))

(library
 (name test_inline_tests)
 (inline_tests)
 (modules test_expect_test)
 (libraries minidebug_runtime)
 (preprocess
  (pps ppx_minidebug ppx_deriving.show ppx_expect)))